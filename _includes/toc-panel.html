{% if page.toc %}
  <section class="toc-section">
    <h3 class="panel-heading">Contents</h3>
    <div id="toc" class="panel-body">
      {% assign content_parts = content | split: '<h2' %}
      <ul class="section-nav">
        {% for part in content_parts offset: 1 %}
          {% assign section = part | split: '</h2>' %}
          {% assign section_title = section.first | split: '>' | last | strip %}
          {% assign section_id = section.first | split: 'id="' | last | split: '"' | first %}
          <li class="toc-entry">
            <a href="#{{ section_id }}" class="toc-section-link">{{ section_title }}</a>
            
            {% assign subsections = section.last | split: '<h3' %}
            {% if subsections.size > 1 %}
              <ul class="subsection-nav">
                {% for subsection in subsections offset: 1 %}
                  {% assign sub_title = subsection | split: '</h3>' | first | split: '>' | last | strip %}
                  {% assign sub_id = subsection | split: 'id="' | last | split: '"' | first %}
                  <li class="toc-subsection">
                    <a href="#{{ sub_id }}">{{ sub_title }}</a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  </section>
{% endif %}
